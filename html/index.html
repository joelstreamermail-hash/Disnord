<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disnord App</title>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        /* Spezifisches Layout für die App */
        .app-container { display: flex; height: 100vh; padding: 20px; gap: 20px; }
        
        /* Linke Leiste (Server Dock) */
        .server-dock {
            width: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
            gap: 15px;
        }
        
        .server-icon {
            width: 50px; height: 50px;
            border-radius: 50%; /* Rund */
            background: rgba(255,255,255,0.1);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.3s;
            color: white; font-weight: bold; border: 1px solid rgba(255,255,255,0.2);
        }
        .server-icon:hover { background: var(--primary-color); transform: scale(1.1); box-shadow: 0 0 15px var(--primary-color); }
        .add-btn { font-size: 24px; border: 2px dashed rgba(255,255,255,0.3); background: transparent; }

        /* Chat Bereich */
        .chat-container { flex: 1; display: flex; flex-direction: column; padding: 0; overflow: hidden; }
        .chat-header { padding: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); font-size: 18px; font-weight: bold; }
        .messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        
        /* Nachrichten Bubble Style */
        .msg { padding: 10px 15px; border-radius: 12px; max-width: 80%; width: fit-content; background: rgba(255,255,255,0.08); }
        .msg strong { color: var(--primary-color); display: block; font-size: 0.8em; margin-bottom: 2px; }

        .input-area { padding: 20px; display: flex; gap: 10px; }
        .input-area input { margin: 0; }
    </style>
</head>
<body>

    <div class="app-container">
        <nav class="glass-panel server-dock">
            <div id="server-list" style="display:flex; flex-direction:column; gap:10px; width:100%; align-items:center;">
                </div>
            <div class="server-icon add-btn" onclick="askServerName()">+</div>
        </nav>

        <main class="glass-panel chat-container">
            <div class="chat-header"># Allgemein</div>
            <div id="messages" class="messages">
                </div>
            <div class="input-area">
                <input type="text" id="msgInput" placeholder="Schreibe etwas...">
                <button class="btn btn-primary" onclick="sendMessage()">➤</button>
            </div>
        </main>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const user = localStorage.getItem('disnord_user') || 'Gast';
        if(!localStorage.getItem('user')) window.location.href = '/login';
        
        // Nachrichten empfangen
        socket.on('chat-message', (msg) => {
            const div = document.createElement('div');
            div.className = 'msg';
            div.innerHTML = `<strong>${msg.user}</strong>${msg.text}`;
            const box = document.getElementById('messages');
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
        });

        socket.on('history', (msgs) => {
            msgs.forEach(m => {
                const div = document.createElement('div');
                div.className = 'msg';
                div.innerHTML = `<strong>${m.user}</strong>${m.text}`;
                document.getElementById('messages').appendChild(div);
            });
        });

        // Server Liste
        socket.on('server-list', (servers) => {
            const list = document.getElementById('server-list');
            list.innerHTML = '';
            servers.forEach(srv => {
                const icon = document.createElement('div');
                icon.className = 'server-icon';
                icon.innerText = srv.name.substring(0,2).toUpperCase();
                icon.title = srv.name;
                list.appendChild(icon);
            });
        });

        function sendMessage() {
            const input = document.getElementById('msgInput');
            if(input.value) {
                socket.emit('chat-message', { user: user, text: input.value });
                input.value = '';
            }
        }
        
        // Enter Taste
        document.getElementById('msgInput').addEventListener('keypress', (e) => {
            if(e.key === 'Enter') sendMessage();
        });

        function askServerName() {
            const name = prompt("Wie soll der neue Server heißen?");
            if(name) socket.emit('create-server', { name: name });
        }
    </script>
</body>
</html>