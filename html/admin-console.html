<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body style="padding:20px; overflow-y:auto;">
    <div style="max-width:1000px; margin:auto;">
        <div class="glass-panel" style="width:100%; max-width:none; display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h2 style="margin:0;">üõ°Ô∏è ADMIN</h2>
            <button class="btn" style="width:auto; padding:5px 15px;" onclick="location.href='/settings'">ZUR√úCK</button>
        </div>
        <div id="user-grid" class="admin-grid"></div>
    </div>
    <script>
        const me = localStorage.getItem('disnord_user');
        const uid = localStorage.getItem('disnord_uid');
        async function load() {
            const res = await fetch('/api/admin/list', {
                method:'POST', headers:{'Content-Type':'application/json'},
                body:JSON.stringify({adminName: me, adminUid: uid})
            });
            const d = await res.json();
            if(!d.success) return document.body.innerHTML = "Zugriff verweigert";
            const grid = document.getElementById('user-grid');
            grid.innerHTML = "";
            for(let name in d.users) {
                if(name === me) continue;
                const u = d.users[name];
                const isMod = d.mods.includes(u.uid);
                const isBanned = u.bannedUntil > Date.now();
                const card = document.createElement('div');
                card.className = "glass-panel";
                card.style = "width:100%; text-align:left; padding:15px;";
                card.innerHTML = `
                    <b>${name}</b> <small>${u.uid}</small> ${isMod ? '[MOD]' : ''}<br>
                    <small>Status: ${isBanned ? 'BANNED' : 'OK'}</small>
                    <div style="display:flex; gap:5px; margin-top:10px;">
                        <button class="btn" onclick="act('${name}','warn')">Warn</button>
                        <button class="btn" style="background:red;" onclick="act('${name}','ban', prompt('Stunden?'))">Ban</button>
                    </div>
                    ${d.role === 'DEV' ? `<button class="btn" style="margin-top:5px;" onclick="act('${name}','toggle-mod')">${isMod ? 'Entmodden' : 'Mod machen'}</button>` : ''}
                `;
                grid.appendChild(card);
            }
        }
        async function act(targetName, action, value) {
            await fetch('/api/admin/action', {
                method:'POST', headers:{'Content-Type':'application/json'},
                body:JSON.stringify({adminName: me, adminUid: uid, targetName, action, value})
            });
            load();
        }
        load();
    </script>
</body>
</html>